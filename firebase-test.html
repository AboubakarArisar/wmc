<!DOCTYPE html>
<html>
<head>
    <title>Firebase Connection Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .container { max-width: 800px; }
        .card { margin-bottom: 20px; }
        .log-output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: scroll;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Firebase Connection Test</h1>

        <div class="card">
            <div class="card-header">Firebase Configuration</div>
            <div class="card-body">
                <p>Please ensure your Firebase configuration is updated in the script below.</p>
                <pre id="firebase-config-display"></pre>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Authentication Test</div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="email" id="auth-email" class="form-control" placeholder="Email">
                </div>
                <div class="mb-3">
                    <input type="password" id="auth-password" class="form-control" placeholder="Password">
                </div>
                <div class="mb-3">
                    <input type="text" id="auth-username" class="form-control" placeholder="Username (for registration)">
                </div>
                <button id="register-btn" class="btn btn-primary me-2">Register</button>
                <button id="login-btn" class="btn btn-success me-2">Login</button>
                <button id="logout-btn" class="btn btn-warning me-2">Logout</button>
                <button id="reset-password-btn" class="btn btn-info">Reset Password</button>
                <p class="mt-3">Current User: <span id="current-user">None</span></p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Firestore Test</div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" id="firestore-collection" class="form-control" value="testCollection" placeholder="Collection Name">
                </div>
                <div class="mb-3">
                    <input type="text" id="firestore-doc-id" class="form-control" placeholder="Document ID (optional)">
                </div>
                <div class="mb-3">
                    <textarea id="firestore-data" class="form-control" rows="3" placeholder="JSON data for document (e.g., {&quot;name&quot;: &quot;Test&quot;})"></textarea>
                </div>
                <button id="add-doc-btn" class="btn btn-primary me-2">Add Document</button>
                <button id="get-docs-btn" class="btn btn-info me-2">Get All Documents</button>
                <button id="get-doc-btn" class="btn btn-secondary me-2">Get Document by ID</button>
                <button id="update-doc-btn" class="btn btn-warning me-2">Update Document</button>
                <button id="delete-doc-btn" class="btn btn-danger">Delete Document</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Log Output</div>
            <div class="card-body">
                <div id="log-output" class="log-output"></div>
                <button id="clear-log-btn" class="btn btn-secondary btn-sm mt-2">Clear Log</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebase/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebase/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebase/9.6.10/firebase-firestore.js"></script>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBY8bpwNwpCSyJX9yWosWULSXzQS9_qfm0",
            authDomain: "wmc-project-f5861.firebaseapp.com",
            projectId: "wmc-project-f5861",
            storageBucket: "wmc-project-f5861.firebasestorage.app",
            messagingSenderId: "92154463945",
            appId: "1:92154463945:web:d17fbfd846b0c1b1d1af18",
            measurementId: "G-CFBW3D9592"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const logOutput = document.getElementById('log-output');
        const currentUserSpan = document.getElementById('current-user');

        function log(message, isError = false) {
            const timestamp = new Date().toLocaleTimeString();
            const formattedMessage = `[${timestamp}] ${message}`;
            const p = document.createElement('p');
            p.textContent = formattedMessage;
            if (isError) {
                p.style.color = 'red';
            }
            logOutput.appendChild(p);
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(formattedMessage);
        }

        document.getElementById('clear-log-btn').addEventListener('click', () => {
            logOutput.innerHTML = '';
        });

        // Display Firebase config
        document.getElementById('firebase-config-display').textContent = JSON.stringify(firebaseConfig, null, 2);

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUserSpan.textContent = user.email;
                log(`Auth State Changed: User logged in - ${user.email}`);
            } else {
                currentUserSpan.textContent = 'None';
                log('Auth State Changed: User logged out');
            }
        });

        // --- Authentication Functions ---
        document.getElementById('register-btn').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const username = document.getElementById('auth-username').value;
            if (!email || !password || !username) {
                log('Email, password, and username are required for registration.', true);
                return;
            }
            try {
                log(`Attempting to register user: ${email}`);
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: username });
                await db.collection('users').doc(userCredential.user.uid).set({
                    uid: userCredential.user.uid,
                    email: email,
                    username: username,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                log(`Registration successful for ${userCredential.user.email}`);
            } catch (error) {
                log(`Registration failed: ${error.message}`, true);
            }
        });

        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            if (!email || !password) {
                log('Email and password are required for login.', true);
                return;
            }
            try {
                log(`Attempting to log in user: ${email}`);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                log(`Login successful for ${userCredential.user.email}`);
            } catch (error) {
                log(`Login failed: ${error.message}`, true);
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                log('Attempting to log out user.');
                await auth.signOut();
                log('Logout successful.');
            } catch (error) {
                log(`Logout failed: ${error.message}`, true);
            }
        });

        document.getElementById('reset-password-btn').addEventListener('click', async () => {
            const email = document.getElementById('auth-email').value;
            if (!email) {
                log('Email is required to reset password.', true);
                return;
            }
            try {
                log(`Attempting to send password reset to: ${email}`);
                await auth.sendPasswordResetEmail(email);
                log(`Password reset email sent to ${email}. Check your inbox.`);
            } catch (error) {
                log(`Password reset failed: ${error.message}`, true);
            }
        });

        // --- Firestore Functions ---
        document.getElementById('add-doc-btn').addEventListener('click', async () => {
            const collectionName = document.getElementById('firestore-collection').value;
            const docData = document.getElementById('firestore-data').value;
            if (!collectionName || !docData) {
                log('Collection name and data are required to add a document.', true);
                return;
            }
            try {
                const data = JSON.parse(docData);
                log(`Adding document to collection "${collectionName}" with data: ${docData}`);
                const docRef = await db.collection(collectionName).add(data);
                log(`Document added with ID: ${docRef.id}`);
            } catch (error) {
                log(`Failed to add document: ${error.message}`, true);
            }
        });

        document.getElementById('get-docs-btn').addEventListener('click', async () => {
            const collectionName = document.getElementById('firestore-collection').value;
            if (!collectionName) {
                log('Collection name is required to get documents.', true);
                return;
            }
            try {
                log(`Getting all documents from collection "${collectionName}"`);
                const snapshot = await db.collection(collectionName).get();
                snapshot.forEach(doc => {
                    log(`Doc ID: ${doc.id}, Data: ${JSON.stringify(doc.data())}`);
                });
                log(`Found ${snapshot.size} documents.`);
            } catch (error) {
                log(`Failed to get documents: ${error.message}`, true);
            }
        });

        document.getElementById('get-doc-btn').addEventListener('click', async () => {
            const collectionName = document.getElementById('firestore-collection').value;
            const docId = document.getElementById('firestore-doc-id').value;
            if (!collectionName || !docId) {
                log('Collection name and document ID are required to get a document.', true);
                return;
            }
            try {
                log(`Getting document "${docId}" from collection "${collectionName}"`);
                const doc = await db.collection(collectionName).doc(docId).get();
                if (doc.exists) {
                    log(`Doc ID: ${doc.id}, Data: ${JSON.stringify(doc.data())}`);
                } else {
                    log(`Document "${docId}" not found.`, true);
                }
            } catch (error) {
                log(`Failed to get document: ${error.message}`, true);
            }
        });

        document.getElementById('update-doc-btn').addEventListener('click', async () => {
            const collectionName = document.getElementById('firestore-collection').value;
            const docId = document.getElementById('firestore-doc-id').value;
            const docData = document.getElementById('firestore-data').value;
            if (!collectionName || !docId || !docData) {
                log('Collection name, document ID, and data are required to update a document.', true);
                return;
            }
            try {
                const data = JSON.parse(docData);
                log(`Updating document "${docId}" in collection "${collectionName}" with data: ${docData}`);
                await db.collection(collectionName).doc(docId).update(data);
                log(`Document "${docId}" updated successfully.`);
            } catch (error) {
                log(`Failed to update document: ${error.message}`, true);
            }
        });

        document.getElementById('delete-doc-btn').addEventListener('click', async () => {
            const collectionName = document.getElementById('firestore-collection').value;
            const docId = document.getElementById('firestore-doc-id').value;
            if (!collectionName || !docId) {
                log('Collection name and document ID are required to delete a document.', true);
                return;
            }
            try {
                log(`Deleting document "${docId}" from collection "${collectionName}"`);
                await db.collection(collectionName).doc(docId).delete();
                log(`Document "${docId}" deleted successfully.`);
            } catch (error) {
                log(`Failed to delete document: ${error.message}`, true);
            }
        });
    </script>
</body>
</html>
