@@include('./partials/html.html')

<head>
    @@include("./partials/title-meta.html", {"title": "Dashboard"})

    @@include('./partials/head-css.html')
</head>

<body>

    <!-- Top Bar Start -->
    @@include('./partials/topbar.html')
    <!-- Top Bar End -->
    <!-- leftbar-tab-menu -->
    @@include('./partials/startbar.html')
    <!-- end leftbar-tab-menu-->

    <div class="page-wrapper">

        <!-- Page Content-->
        <div class="page-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="page-title-box d-md-flex justify-content-md-between align-items-center">
                            <h4 class="page-title">Dashboard</h4>
                            <div class="">
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a href="#">WMC</a>
                                    </li><!--end nav-item-->
                                    <li class="breadcrumb-item active">Dashboard</li>
                                </ol>
                            </div>                            
                        </div><!--end page-title-box-->
                    </div><!--end col-->
                </div><!--end row-->
                <div class="row justify-content-center">
                    <div class="col-md-6 col-lg-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="flex-shrink-0 bg-primary-subtle text-primary thumb-md rounded-circle">
                                        <i class="iconoir-dollar-circle fs-4"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-2 text-truncate">
                                        <p class="text-dark mb-0 fw-semibold fs-14">Total Revenue</p>
                                        <p class="mb-0 text-truncate text-muted"><span class="text-success">8.5%</span>
                                            Increase from last month</p>
                                    </div><!--end media-body-->
                                </div><!--end media-->
                                <div class="row d-flex justify-content-center">
                                    <div class="col">                                        
                                        <h3 class="mt-2 mb-0 fw-bold revenue-card">$8365.00</h3>
                                    </div>
                                    <!--end col-->
                                    <div class="col align-self-center">
                                        <img src="assets/images/extra/line-chart.png" alt="" class="img-fluid">
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                            <!--end card-body-->
                        </div>
                        <!--end card-->
                    </div>
                    <!--end col-->
                    <div class="col-md-6 col-lg-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="flex-shrink-0 bg-info-subtle text-info thumb-md rounded-circle">
                                        <i class="iconoir-cart fs-4"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-2 text-truncate">
                                        <p class="text-dark mb-0 fw-semibold fs-14">New Order</p>
                                        <p class="mb-0 text-truncate text-muted"><span class="text-success">1.7%</span>
                                            Increase from last month</p>
                                    </div><!--end media-body-->
                                </div><!--end media-->
                                <div class="row d-flex justify-content-center">
                                    <div class="col">                                        
                                        <h3 class="mt-2 mb-0 fw-bold orders-card">865</h3>
                                    </div>
                                    <!--end col-->
                                    <div class="col align-self-center">
                                        <img src="assets/images/extra/bar.png" alt="" class="img-fluid">
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                            <!--end card-body-->
                        </div>
                        <!--end card-->
                    </div>
                    <!--end col-->
                    <div class="col-md-6 col-lg-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="flex-shrink-0 bg-warning-subtle text-warning thumb-md rounded-circle">
                                        <i class="iconoir-percentage-circle fs-4"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-2 text-truncate">
                                        <p class="text-dark mb-0 fw-semibold fs-14">Sessions</p>
                                        <p class="mb-0 text-truncate text-muted"><span class="text-danger">0.7%</span>
                                            Decrease from last month</p>
                                    </div><!--end media-body-->
                                </div><!--end media-->
                                <div class="row d-flex justify-content-center">
                                    <div class="col">                                        
                                        <h3 class="mt-2 mb-0 fw-bold sessions-card">155</h3>
                                    </div>
                                    <!--end col-->
                                    <div class="col align-self-center">
                                        <img src="assets/images/extra/donut.png" alt="" class="img-fluid">
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                            <!--end card-body-->
                        </div>
                        <!--end card-->
                    </div>
                    <!--end col-->
                    <div class="col-md-6 col-lg-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="flex-shrink-0 bg-danger-subtle text-danger thumb-md rounded-circle">
                                        <i class="iconoir-hexagon-dice fs-4"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-2 text-truncate">
                                        <p class="text-dark mb-0 fw-semibold fs-14">Avg. Order value</p>
                                        <p class="mb-0 text-truncate text-muted"><span class="text-success">2.7%</span>
                                            Increase from last month</p>
                                    </div><!--end media-body-->
                                </div><!--end media-->
                                <div class="row d-flex justify-content-center">
                                    <div class="col">                                        
                                        <h3 class="mt-2 mb-0 fw-bold avg-order-card">$12550.00</h3>
                                    </div>
                                    <!--end col-->
                                    <div class="col align-self-center">
                                        <img src="assets/images/extra/tree.png" alt="" class="img-fluid">
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                            <!--end card-body-->
                        </div>
                        <!--end card-->
                    </div>
                    <!--end col-->                    
                </div>
                <!--end row-->
                <!-- Removed static charts and lists for Stripe-only dashboard -->
            </div><!-- container -->

            <!--Start Rightbar-->
            @@include('./partials/endbar.html')
            <!--end Rightbar-->
            <!--Start Footer-->
            @@include('./partials/footer.html')
            <!--end footer-->
        </div>
        <!-- end page content -->
    </div>
    <!-- end page-wrapper -->

    <!-- Javascript  -->
    <!-- vendor js -->
    @@include('./partials/vendorjs.html')

    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
    <script src="https://apexcharts.com/samples/assets/stock-prices.js"></script>
    <script src="assets/js/pages/index.init.js"></script>
    <script src="assets/js/app.js"></script>
    <!-- Data Service Scripts -->
    <script type="module" src="assets/js/services/firebase-config.js"></script>
    <script type="module" src="assets/js/services/stripe-config.js"></script>
    <script type="module" src="assets/js/services/data-service.js"></script>
    <script type="module" src="assets/js/pages/dashboard-data.init.js"></script>
    <script type="module" src="assets/js/pages/prints-chart.init.js"></script>

    <!-- Authentication Scripts -->
    <script type="module" src="assets/js/services/auth-service.js"></script>
    <script type="module">
        import authService from './assets/js/services/auth-service.js';
        document.addEventListener('DOMContentLoaded', () => {
            // If not authenticated, send to login as the starter page
            authService.addListener('authStateChanged', (user) => {
                if (!user) {
                    window.location.replace('auth-login.html');
                }
            });
        });
    </script>
    <script>
        (function(){
            function setText(sel, val){
                var el = document.querySelector(sel);
                if(el){ el.textContent = val; }
            }
            fetch('/api/stripe-metrics')
              .then(function(r){ return r.ok ? r.json() : Promise.reject(); })
              .then(function(data){
                  var totalRevenue = Number(data.totalRevenue)||0;
                  var newOrders = Number(data.newOrders)||0;
                  var cancellations = Number(data.cancellations)||0;
                  var aov = Number(data.averageOrderValue)||0;
                  setText('.revenue-card', '$'+ totalRevenue.toLocaleString());
                  setText('.orders-card', newOrders.toLocaleString());
                  setText('.sessions-card', cancellations.toLocaleString());
                  setText('.avg-order-card', '$'+ aov.toLocaleString());
              })
              .catch(function(){
                  setText('.revenue-card', '$0');
                  setText('.orders-card', '0');
                  setText('.sessions-card', '0');
                  setText('.avg-order-card', '$0');
              });
        })();
    </script>
</body>
<!--end body-->

</html>
